<html>
<head>
  <!--https://github.com/jamis/csmazes/tree/master
  https://stackoverflow.com/questions/38502/whats-a-good-algorithm-to-generate-a-maze-->
  <title>Maze Game</title>
  <link rel="stylesheet" type="text/css" href="css/mazes.css" />
  
  <!--jQuery, Popper.js, Bootstrap.js-->
  <script src="https://code.jquery.com/jquery-3.7.0.js" integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>        
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>        
  
  <!-- BOOTSTRAP -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">        
        
  <script src="maze.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script type="text/javascript">
    function resetMazes() {
      for(var i = 0; i < arguments.length; i++) {
        var id = arguments[i];
        var element = document.getElementById(id);
        element.mazeReset();
      }
    }
  </script>

  <style type="text/css">
    img {
      vertical-align:unset;
    }

    h1 {
      font-size: 24px;
      margin: 20px;
      margin-bottom: 10px;
    }

    p {
      margin: 10px 20px;
    }

    small {
      color: #777;
      font-size: 11px;
    }

    input { width: 50%; }
  </style>
</head>
<body>
  <div id="bg-container">        
  </div>
  <div id='game-container' class="container">
    <div id="header-container">
      <h1>Escape the maze!</h1>
    </div>
    
    <div id="maze-container">
      <script type="text/javascript">
        var mazeSize = 7;
        Maze.createWidget("Kruskal", mazeSize, mazeSize, { "class": "small", "watch": false });
      </script>
    </div>

    <div id="footer-container">
      <h1>Escape the maze!</h1>

    </div>
  </div>

</body>
<script>
    var currentX = 0;
    var currentY = 0;

    var coin = 0;

    $(document).ready(function(){
        document.getElementById('kruskal').mazeRun(); 

        for (let i = 0; i < mazeSize ; i ++) {
          for (let j = 0; j < mazeSize ; j ++) {
            if(i != 0 || j != 0) $(`#kruskal_y${i}x${j}`).append('<img src="coin-nobg.gif" style="height:100%; image-rendering: pixelated; padding-top:1px; object-fit:scale-down">')
          }
        }
        let gridSize = (window.innerHeight > window.innerWidth) ? $('#maze-container').width() :  $('#maze-container').height();
        $('#kruskal_y0x0').append('<img src="cat-idle-nobg.gif" style="height:100%; image-rendering: pixelated; padding-top:1px">')
        $('.small .grid .box > div').css({'width': `${gridSize / mazeSize}px`, 'height': `${gridSize / mazeSize}px`})
        $(document).keydown(function(event){
            // event.which is deprecated, event.key is the modern approach
            var keyPressed = event.key; // Get the key that was pressed
            var element = document.getElementById(`kruskal_y${currentY}x${currentX}`);

            if (event.key == 'w' || event.key == 'W') {

              if(element.classList.contains('n')) {
                $(`#kruskal_y${currentY}x${currentX}`).empty()
                currentY -= 1;
                updateMaze();
              
              } else {
                console.log('blocked');
              }

            } else if (event.key == 'a' || event.key == 'A') {

              if(element.classList.contains('w')) {
                $(`#kruskal_y${currentY}x${currentX}`).empty()
                currentX -= 1;
                updateMaze();

              } else {
                console.log('blocked');
              }

            } else if (event.key == 's' || event.key == 'S') {

              if(element.classList.contains('s')) {
                $(`#kruskal_y${currentY}x${currentX}`).empty()
                currentY += 1;
                updateMaze();
              
              } else {
                console.log('blocked');
              }

            } else if (event.key == 'd' || event.key == 'D') {

              if(element.classList.contains('e')) {
                $(`#kruskal_y${currentY}x${currentX}`).empty()
                currentX += 1;
                updateMaze();

               } else {
                console.log('blocked');
              }

            } 

            console.log("Key pressed: " + keyPressed);
        });
    });
    
    function updateMaze() {
      var divChildren = $(`#kruskal_y${currentY}x${currentX}`).children().length;
      if (divChildren > 0) { 
        coin++
        $('#coin').html(coin);
        $(`#kruskal_y${currentY}x${currentX}`).empty()
      }
      $(`#kruskal_y${currentY}x${currentX}`).append('<img src="cat-idle-nobg.gif" style="height:100%; image-rendering: pixelated; padding-top:1px;">')           
    }

</script>
</html>
